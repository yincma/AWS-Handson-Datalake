# AWS ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ç·åˆå®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€AWSã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’åŸºç›¤ã¨ã—ãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¼ãƒ­ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚å¤šå±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆï¼ˆRaw â†’ Clean â†’ Analyticsï¼‰ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ã€å¤‰æ›ã€åˆ†æã®å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯è¨­å®šé§†å‹•æ–¹å¼ã‚’æ¡ç”¨ã—ã€å®Œå…¨ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€å­¦ç¿’è€…ãŒä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’è¿…é€Ÿã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚


## ç›®æ¬¡
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
- [æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
- [æ¨©é™ã¨ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«](#æ¨©é™ã¨ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«)
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
- [ã‚³ã‚¢æ©Ÿèƒ½](#ã‚³ã‚¢æ©Ÿèƒ½)
- [å®Ÿé¨“æ‰‹é †](#å®Ÿé¨“æ‰‹é †)
- [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
- [äºˆæƒ³æ™‚é–“ã¨ã‚³ã‚¹ãƒˆ](#äºˆæƒ³æ™‚é–“ã¨ã‚³ã‚¹ãƒˆ)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](#ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰)
  - [ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™](#ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™)
  - [åŸºç›¤ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ‡ãƒ—ãƒ­ã‚¤](#åŸºç›¤ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ‡ãƒ—ãƒ­ã‚¤)
  - [ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯éšå±¤ã®æ§‹ç¯‰](#ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯éšå±¤ã®æ§‹ç¯‰)
  - [ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç’°å¢ƒã®è¨­å®š](#ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç’°å¢ƒã®è¨­å®š)
  - [åˆ†æç’°å¢ƒã®æ§‹æˆ](#åˆ†æç’°å¢ƒã®æ§‹æˆ)
  - [æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ](#æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ)
  - [ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¨æœ€é©åŒ–](#ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¨æœ€é©åŒ–)
- [æ‹¡å¼µå­¦ç¿’](#æ‹¡å¼µå­¦ç¿’)
- [ãƒ©ã‚¤ã‚»ãƒ³ã‚¹](#ãƒ©ã‚¤ã‚»ãƒ³ã‚¹)

## æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ã‚¢ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ã‚¿ãƒƒã‚¯
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤**: Amazon S3 (éšå±¤ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ + ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†)
- **ãƒ‡ãƒ¼ã‚¿ã‚¬ãƒãƒŠãƒ³ã‚¹**: AWS Lake Formation (æ¨©é™åˆ¶å¾¡ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†)
- **ETLã‚¨ãƒ³ã‚¸ãƒ³**: AWS Glue (Crawler + DataBrew + ETL Jobs)
- **è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³**: Amazon EMR (Sparkåˆ†æ•£è¨ˆç®—)
- **åˆ†æã‚¨ãƒ³ã‚¸ãƒ³**: Amazon Athena (ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ SQL ã‚¯ã‚¨ãƒª)

### ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

![AWS Data Lake Architecture](./Arch.drawio.svg)

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°å›³

```mermaid
flowchart TD
    %% Data Sources
    Start([ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹]) --> Upload[ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    Upload --> RawBucket[ğŸ“¦ Raw Layer<br/>Bronze Tier]

    %% Discovery Phase
    RawBucket --> Crawler[ğŸ” Glue Crawler]
    Crawler --> Schema[ã‚¹ã‚­ãƒ¼ãƒç™ºè¦‹]
    Schema --> Catalog[ğŸ“š Data Catalog<br/>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç™»éŒ²]

    %% Cleaning Phase  
    RawBucket --> DataBrew[ğŸ§ª Glue DataBrew]
    DataBrew --> Clean[ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°]
    Clean --> CleanBucket[âœ¨ Clean Layer<br/>Silver Tier]

    %% Analytics Phase
    CleanBucket --> EMR[âš¡ EMR Cluster]
    EMR --> Process[PySparkå‡¦ç†<br/>é›†ç´„ãƒ»åˆ†æ]
    Process --> AnalyticsBucket[ğŸ“Š Analytics Layer<br/>Gold Tier]

    %% Query Phase
    Catalog --> Athena[ğŸ” Amazon Athena]
    CleanBucket --> Athena
    AnalyticsBucket --> Athena
    Athena --> Results[ğŸ“‹ ã‚¯ã‚¨ãƒªçµæœ]
    
    %% Business Intelligence
    Results --> BI[ğŸ“ˆ BI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰<br/>QuickSight]

    %% Governance Layer
    subgraph Governance[ğŸ›¡ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¬ãƒãƒŠãƒ³ã‚¹]
        LakeFormation[Lake Formation<br/>æ¨©é™ç®¡ç†]
        IAM[IAM ãƒ­ãƒ¼ãƒ«<br/>ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡]
    end
    
    LakeFormation -.-> RawBucket
    LakeFormation -.-> CleanBucket  
    LakeFormation -.-> AnalyticsBucket
    IAM -.-> EMR
    IAM -.-> Athena

    %% Processing Phases
    classDef bronze fill:#CD7F32,stroke:#8B4513,stroke-width:2px,color:white
    classDef silver fill:#C0C0C0,stroke:#808080,stroke-width:2px,color:#000
    classDef gold fill:#FFD700,stroke:#DAA520,stroke-width:2px,color:#000
    classDef process fill:#87CEEB,stroke:#4682B4,stroke-width:2px,color:#000
    classDef governance fill:#98FB98,stroke:#228B22,stroke-width:2px,color:#000

    class RawBucket bronze
    class CleanBucket silver
    class AnalyticsBucket gold
    class Crawler,DataBrew,EMR,Athena process
    class LakeFormation,IAM governance
```

### æ¨©é™ã¨ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ¢ãƒ‡ãƒ«
- **Lake Formation**: çµ±ä¸€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚«ã‚¿ãƒ­ã‚°ã¨ç´°ã‹ã„æ¨©é™åˆ¶å¾¡
- **IAMãƒ­ãƒ¼ãƒ«**: è·è²¬ãƒ™ãƒ¼ã‚¹ã®æ¨©é™åˆ†é›¢ï¼ˆDataEngineerã€Analystç­‰ï¼‰
- **ã‚¯ãƒ­ã‚¹ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ**: EMRã€Glueã€Athenaã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªæ¨©é™ç¶™æ‰¿

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
Datalake/
â”œâ”€â”€ configs/                    # è¨­å®šç®¡ç†
â”‚   â”œâ”€â”€ config.env             # ãƒ¡ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰
â”‚   â”œâ”€â”€ config.local.env       # ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â””â”€â”€ env-vars.sh            # ç’°å¢ƒå¤‰æ•°ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”œâ”€â”€ scripts/                   # è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ setup-env.sh          # ç’°å¢ƒåˆæœŸåŒ–
â”‚   â”œâ”€â”€ cleanup.sh            # ãƒªã‚½ãƒ¼ã‚¹æ¸…ç†
â”‚   â”œâ”€â”€ create-emr-cluster.sh # EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ
â”‚   â”œâ”€â”€ cost-optimization.sh  # ã‚³ã‚¹ãƒˆæœ€é©åŒ–
â”‚   â”œâ”€â”€ submit_pyspark_job.sh # Sparkã‚¸ãƒ§ãƒ–é€ä¿¡
â”‚   â”œâ”€â”€ pyspark_analytics.py  # PySparkã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ athena_queries.sql    # Athena ã‚¯ã‚¨ãƒªã‚µãƒ³ãƒ—ãƒ«
â”œâ”€â”€ templates/                 # CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ s3-storage-layer.yaml      # S3 ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤
â”‚   â”œâ”€â”€ iam-roles-policies.yaml    # IAM ãƒ­ãƒ¼ãƒ«æ¨©é™
â”‚   â”œâ”€â”€ lake-formation.yaml        # Lake Formation è¨­å®š
â”‚   â””â”€â”€ cost-monitoring.yaml       # ã‚³ã‚¹ãƒˆç›£è¦–
â””â”€â”€ sample-data/               # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
    â”œâ”€â”€ customers.csv          # é¡§å®¢ãƒ‡ãƒ¼ã‚¿
    â”œâ”€â”€ orders.csv            # æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿
    â”œâ”€â”€ order_items.csv       # æ³¨æ–‡æ˜ç´°
    â””â”€â”€ products.csv          # è£½å“ãƒ‡ãƒ¼ã‚¿
```

## ã‚³ã‚¢æ©Ÿèƒ½

### 1. è¨­å®šé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **çµ±åˆè¨­å®š**: `configs/config.env` ã§ã™ã¹ã¦ã®AWSãƒªã‚½ãƒ¼ã‚¹è¨­å®šã‚’é›†ä¸­ç®¡ç†
- **ç’°å¢ƒåˆ†é›¢**: ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ï¼ˆ`config.local.env`ï¼‰ã‚’ã‚µãƒãƒ¼ãƒˆ
- **è‡ªå‹•åŒ–**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆ
- **å‘½åè¦ç´„**: çµ±ä¸€ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹å‘½åè¦ç´„ï¼ˆ`${PROJECT_PREFIX}-${SUFFIX}`ï¼‰

### 2. Infrastructure as Code
- **CloudFormation ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: å®Œå…¨ãªIaCå®Ÿè£…
- **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: æ©Ÿèƒ½åˆ¥ã«åˆ†é›¢ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®å¤‰æ›´ãŒè¿½è·¡å¯èƒ½
- **å†ç¾å¯èƒ½ãƒ‡ãƒ—ãƒ­ã‚¤**: è¤‡æ•°ç’°å¢ƒã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆ

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¬ãƒãƒŠãƒ³ã‚¹
- **æœ€å°æ¨©é™åŸå‰‡**: ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®è©³ç´°ãªæ¨©é™åˆ¶å¾¡
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: S3ã¨è»¢é€ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ–
- **ç›£æŸ»ãƒ­ã‚°**: CloudTrailçµ±åˆã€å®Œå…¨ãªæ“ä½œç›£æŸ»
- **åˆ—ãƒ¬ãƒ™ãƒ«æ¨©é™**: Lake Formationã®ç´°ã‹ã„ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 4. ã‚³ã‚¹ãƒˆæœ€é©åŒ–
- **è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: å®Œå…¨ãªãƒªã‚½ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ¤œå‡ºã‚µãƒãƒ¼ãƒˆï¼‰
- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**: S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¨å‰Šé™¤
- **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰è¨ˆç®—**: EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èµ·å‹•åœæ­¢ï¼ˆSpotã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚µãƒãƒ¼ãƒˆï¼‰
- **ã‚³ã‚¹ãƒˆç›£è¦–**: CloudWatchã‚³ã‚¹ãƒˆè­¦å‘Šã¨äºˆç®—ã‚¢ãƒ©ãƒ¼ãƒˆ

### 5. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
Eã‚³ãƒãƒ¼ã‚¹ã‚·ãƒŠãƒªã‚ªã®å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æä¾›ï¼š
- **customers.csv**: é¡§å®¢åŸºæœ¬æƒ…å ±
- **products.csv**: è£½å“ã‚«ã‚¿ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿
- **orders.csv**: æ³¨æ–‡ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«
- **order_items.csv**: æ³¨æ–‡è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«

## å®Ÿé¨“æ‰‹é †

### ãƒ•ã‚§ãƒ¼ã‚º1: ç’°å¢ƒæº–å‚™
1. AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã¨æ¨©é™è¨­å®š
2. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒè¨­å®šï¼ˆAWS CLIã€Pythonç­‰ï¼‰
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ‡ãƒ—ãƒ­ã‚¤
1. S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤ä½œæˆï¼ˆRaw/Clean/Analyticsä¸‰å±¤ï¼‰
2. IAMãƒ­ãƒ¼ãƒ«ã¨æ¨©é™ãƒãƒªã‚·ãƒ¼ã®ãƒ‡ãƒ—ãƒ­ã‚¤
3. Lake FormationåˆæœŸåŒ–ã¨æ¨©é™è¨­å®š

### ãƒ•ã‚§ãƒ¼ã‚º3: ãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿ã¨ç™ºè¦‹
1. ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’Rawå±¤ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
2. Glue Crawlerã«ã‚ˆã‚‹è‡ªå‹•Schemaç™ºè¦‹
3. Data Catalogãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

### ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã¨å¤‰æ›
1. Glue DataBrewãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ‡ãƒ¼ã‚¿æº–å‚™
2. ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«è¨­è¨ˆã¨å®Ÿè¡Œ
3. Cleanå±¤ãƒ‡ãƒ¼ã‚¿å“è³ªæ¤œè¨¼

### ãƒ•ã‚§ãƒ¼ã‚º5: ãƒ‡ãƒ¼ã‚¿åˆ†æã¨è¨ˆç®—
1. EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼èµ·å‹•ã¨è¨­å®šï¼ˆcreate-emr-cluster.shã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼‰
2. PySparkãƒãƒƒãƒãƒ‡ãƒ¼ã‚¿å‡¦ç†
3. Analyticså±¤é›†ç´„ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ

### ãƒ•ã‚§ãƒ¼ã‚º6: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åˆ†æ
1. Athenaãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š
2. SQLã‚¯ã‚¨ãƒªã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
3. ã‚¯ã‚¨ãƒªçµæœåˆ†æã¨å¯è¦–åŒ–

### ãƒ•ã‚§ãƒ¼ã‚º7: ç›£è¦–ã¨æœ€é©åŒ–
1. ã‚³ã‚¹ãƒˆç›£è¦–ã¨æœ€é©åŒ–
2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
3. ãƒªã‚½ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¨ç’°å¢ƒå¾©æ—§

## å‰ææ¡ä»¶

### æŠ€è¡“æº–å‚™
- æœ‰åŠ¹ãªAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç®¡ç†è€…æ¨©é™ã‚’æŒã¤ï¼‰
- ãƒ­ãƒ¼ã‚«ãƒ«ã«AWS CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—èªè¨¼æƒ…å ±ã‚’è¨­å®š
- Python 3.7+ç’°å¢ƒ
- SQLã¨Pythonãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®åŸºç¤èƒ½åŠ›

### çŸ¥è­˜è¦ä»¶
- AWSåŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®ç†è§£ï¼ˆIAMã€VPCã€CloudWatchï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ‡ãƒ¼ã‚¿ã‚¦ã‚§ã‚¢ãƒã‚¦ã‚¹ã®åŸºæœ¬æ¦‚å¿µ
- åˆ†æ•£è¨ˆç®—ã®åŸºç¤ç†è§£
- ã‚¯ãƒ©ã‚¦ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æ¨©é™ç®¡ç†ã®æ¦‚å¿µ

## äºˆæƒ³æ™‚é–“ã¨ã‚³ã‚¹ãƒˆ

### æ™‚é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- **åˆè¨ˆ**: 3-4æ™‚é–“ï¼ˆçµŒé¨“ãƒ¬ãƒ™ãƒ«ã«ã‚ˆã‚‹ï¼‰
- **ç’°å¢ƒæº–å‚™**: 30åˆ†
- **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ‡ãƒ—ãƒ­ã‚¤**: 45åˆ†
- **ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ—ãƒ­ã‚»ã‚¹**: 90åˆ†
- **åˆ†æã¨æœ€é©åŒ–**: 45åˆ†
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: 15åˆ†

### ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š
ä¸»è¦èª²é‡‘ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼š
- **S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: $0.023/GB/æœˆï¼ˆæ¨™æº–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
- **EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**: $0.067/æ™‚é–“ï¼ˆm5.xlargeï¼‰
- **Glue**: $0.44/DPU/æ™‚é–“
- **Athena**: $5/TBã‚¹ã‚­ãƒ£ãƒ³ãƒ‡ãƒ¼ã‚¿
- **Lake Formation**: è¿½åŠ æ–™é‡‘ãªã—

> **ã‚³ã‚¹ãƒˆåˆ¶å¾¡ãƒ’ãƒ³ãƒˆ**: EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’é©æ™‚åœæ­¢ã™ã‚‹ã“ã¨ã§å®Ÿé¨“ã‚³ã‚¹ãƒˆã‚’å¤§å¹…ã«å‰Šæ¸›ã§ãã¾ã™

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

1. AWSç’°å¢ƒã‚’è¨­å®šã—ã¾ã™ï¼š
   ```bash
   ./scripts/setup-env.sh
   ```

2. ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç”¨EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ï¼š
   ```bash
   ./scripts/create-emr-cluster.sh --key-name <your-key> --subnet-id <your-subnet>
   ```

3. å®Œäº†å¾Œã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã™ï¼š
   ```bash
   ./scripts/cleanup.sh
   ```

### ğŸ”— ä¾¿åˆ©ãªãƒªãƒ³ã‚¯

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼š
- [S3ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/s3/)
- [Glueç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/glue/)
- [EMRç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/elasticmapreduce/)
- [Athenaç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/athena/)
- [CloudFormationç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/cloudformation/)
- [ã‚³ã‚¹ãƒˆç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://console.aws.amazon.com/billing/)

## ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

ã‚ˆã‚Šè©³ç´°ãªåˆ¶å¾¡ã¨å­¦ç¿’ä½“é¨“ã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰ã‚’æä¾›ã—ã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè¡Œå†…å®¹ã‚’ç†è§£ã—ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

#### ğŸ”§ ç’°å¢ƒæ¤œè¨¼
```bash
# AWSèªè¨¼æƒ…å ±ã‚’ç¢ºèª
aws sts get-caller-identity

# å¿…è¦ãªæ¨©é™ã‚’ãƒ†ã‚¹ãƒˆ
aws iam list-roles --max-items 1

# ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šã‚’ç¢ºèª
aws configure get region
```

#### ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp configs/config.env configs/config.local.env

# å¿…è¦ã«å¿œã˜ã¦ä»¥ä¸‹ã®è¨­å®šã‚’ç·¨é›†ï¼š
# - AWS_REGION: ãƒ‡ãƒ—ãƒ­ã‚¤åœ°åŸŸ
# - PROJECT_PREFIX: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
# - ENVIRONMENT: ç’°å¢ƒåï¼ˆdev/staging/prodï¼‰
# - EMR_INSTANCE_TYPE: EMRã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—
vim configs/config.local.env
```

#### ğŸš¨ ã‚³ã‚¹ãƒˆè¨­å®š
```bash
# ã‚³ã‚¹ãƒˆç›£è¦–ç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®š
export EMAIL_ADDRESS="your-email@example.com"

# äºˆç®—ã¨è­¦å‘Šã®é–¾å€¤è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# configs/config.local.env ã§ DAILY_BUDGET ã‚’è¨­å®š
```

### åŸºç›¤ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒ‡ãƒ—ãƒ­ã‚¤

#### 1ï¸âƒ£ S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤ã®ä½œæˆ
```bash
# S3ãƒã‚±ãƒƒãƒˆã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆ
aws cloudformation deploy \
  --template-file templates/s3-storage-layer.yaml \
  --stack-name datalake-s3-storage-dev \
  --parameter-overrides \
    ProjectPrefix=dl-handson \
    Environment=dev \
  --region us-east-1

# ä½œæˆã•ã‚ŒãŸãƒã‚±ãƒƒãƒˆã‚’ç¢ºèª
aws s3 ls | grep dl-handson
```

#### 2ï¸âƒ£ IAMãƒ­ãƒ¼ãƒ«ã¨ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ç”¨ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆ
aws cloudformation deploy \
  --template-file templates/iam-roles-policies.yaml \
  --stack-name datalake-iam-roles-dev \
  --parameter-overrides \
    ProjectPrefix=dl-handson \
    Environment=dev \
    S3StackName=datalake-s3-storage-dev \
  --capabilities CAPABILITY_NAMED_IAM \
  --region us-east-1

# ä½œæˆã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’ç¢ºèª
aws iam list-roles --query "Roles[?contains(RoleName, 'dl-handson')].RoleName"
```

#### 3ï¸âƒ£ Lake Formationã®åˆæœŸåŒ–
```bash
# Lake Formationãƒ‡ãƒ¼ã‚¿ã‚¬ãƒãƒŠãƒ³ã‚¹ã‚’è¨­å®š
aws cloudformation deploy \
  --template-file templates/lake-formation.yaml \
  --stack-name datalake-lake-formation-dev \
  --parameter-overrides \
    ProjectPrefix=dl-handson \
    Environment=dev \
    S3StackName=datalake-s3-storage-dev \
    IAMStackName=datalake-iam-roles-dev \
  --region us-east-1

# Glueãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª
aws glue get-databases --region us-east-1
```

#### 4ï¸âƒ£ ã‚³ã‚¹ãƒˆç›£è¦–ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```bash
# ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã¨SNSé€šçŸ¥ã‚’è¨­å®š
aws cloudformation deploy \
  --template-file templates/cost-monitoring.yaml \
  --stack-name datalake-cost-monitoring-dev \
  --parameter-overrides \
    ProjectPrefix=dl-handson \
    Environment=dev \
    AlertEmail=$EMAIL_ADDRESS \
  --region us-east-1

# SNSè³¼èª­ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
echo "ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã§SNSç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„"
```

### ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯éšå±¤ã®æ§‹ç¯‰

#### ğŸ¥‰ Rawå±¤ï¼šãƒ‡ãƒ¼ã‚¿å–ã‚Šè¾¼ã¿
```bash
# ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’Rawå±¤ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
aws s3 cp sample-data/customers.csv s3://dl-handson-raw-dev/ecommerce/customers/customers.csv
aws s3 cp sample-data/orders.csv s3://dl-handson-raw-dev/ecommerce/orders/orders.csv  
aws s3 cp sample-data/products.csv s3://dl-handson-raw-dev/ecommerce/products/products.csv
aws s3 cp sample-data/order_items.csv s3://dl-handson-raw-dev/ecommerce/order_items/order_items.csv

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚’ç¢ºèª
aws s3 ls s3://dl-handson-raw-dev/ecommerce/ --recursive
```

#### ğŸ” ã‚¹ã‚­ãƒ¼ãƒç™ºè¦‹ã¨ã‚«ã‚¿ãƒ­ã‚°åŒ–
```bash
# Glue Crawlerã‚’èµ·å‹•ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã‚’è‡ªå‹•ç™ºè¦‹
aws glue start-crawler --name dl-handson-raw-crawler --region us-east-1

# Crawlerå®Ÿè¡ŒçŠ¶æ³ã‚’ç›£è¦–
watch -n 10 'aws glue get-crawler --name dl-handson-raw-crawler --region us-east-1 --query "Crawler.State"'

# ç™ºè¦‹ã•ã‚ŒãŸãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèª
aws glue get-tables --database-name dl_handson_db --region us-east-1
```

#### ğŸ¥ˆ Cleanå±¤ï¼šãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```bash
# Glue DataBrewã§ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
aws databrew create-project \
  --name dl-handson-cleaning-project \
  --dataset-name customers-dataset \
  --recipe-name cleaning-recipe \
  --role-arn arn:aws:iam::ACCOUNT:role/dl-handson-GlueDataBrewRole-dev

# ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œ
aws databrew start-job-run --name cleaning-job
```

### ãƒ‡ãƒ¼ã‚¿å‡¦ç†ç’°å¢ƒã®è¨­å®š

#### âš¡ EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ
```bash
# EC2ã‚­ãƒ¼ãƒšã‚¢ã‚’å–å¾—ï¼ˆEMRã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰
aws ec2 describe-key-pairs --region us-east-1

# ã‚µãƒ–ãƒãƒƒãƒˆIDã‚’å–å¾—
aws ec2 describe-subnets --region us-east-1 --query "Subnets[0].SubnetId"

# EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ä½œæˆï¼ˆSpot instancesä½¿ç”¨ã§ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
./scripts/create-emr-cluster.sh \
  --key-name your-ec2-key-name \
  --subnet-id subnet-xxxxxxxxx \
  --use-spot \
  --auto-terminate

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹ã‚’ç¢ºèª
aws emr list-clusters --region us-east-1 --active
```

#### ğŸ PySparkãƒ‡ãƒ¼ã‚¿å‡¦ç†
```bash
# PySparkåˆ†æã‚¸ãƒ§ãƒ–ã‚’EMRã«æå‡º
./scripts/submit_pyspark_job.sh

# ã‚¸ãƒ§ãƒ–å®Ÿè¡ŒçŠ¶æ³ã‚’ç›£è¦–
aws emr list-steps --cluster-id j-XXXXXXXXX --region us-east-1

# å‡¦ç†çµæœã‚’Cleanå±¤ã§ç¢ºèª
aws s3 ls s3://dl-handson-clean-dev/ --recursive
```

### åˆ†æç’°å¢ƒã®æ§‹æˆ

#### ğŸ” Athenaã‚¯ã‚¨ãƒªç’°å¢ƒã®è¨­å®š
```bash
# Athenaãƒ¯ãƒ¼ã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¨­å®š
aws athena create-work-group \
  --name dl-handson-workgroup \
  --configuration ResultConfigurationUpdates={OutputLocation=s3://dl-handson-athena-results-dev/}

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèª
aws athena start-query-execution \
  --query-string "SHOW DATABASES;" \
  --work-group dl-handson-workgroup \
  --result-configuration OutputLocation=s3://dl-handson-athena-results-dev/
```

#### ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œ
```sql
-- Athenaã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œ

-- 1. åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ç¢ºèª
SELECT * FROM dl_handson_db.customers LIMIT 10;

-- 2. æ³¨æ–‡çµ±è¨ˆåˆ†æ
SELECT 
    EXTRACT(YEAR FROM order_date) as year,
    EXTRACT(MONTH FROM order_date) as month,
    COUNT(*) as order_count,
    SUM(total_amount) as total_sales
FROM dl_handson_db.orders 
GROUP BY EXTRACT(YEAR FROM order_date), EXTRACT(MONTH FROM order_date)
ORDER BY year, month;

-- 3. é¡§å®¢åˆ¥è³¼å…¥åˆ†æ
SELECT 
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent
FROM dl_handson_db.customers c
JOIN dl_handson_db.orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_name
ORDER BY total_spent DESC
LIMIT 10;
```

### æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ

#### âœ… ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å‹•ä½œç¢ºèª
```bash
# 1. å…¨ã¦ã®CloudFormationã‚¹ã‚¿ãƒƒã‚¯ã‚’ç¢ºèª
aws cloudformation list-stacks --stack-status-filter CREATE_COMPLETE UPDATE_COMPLETE

# 2. S3ãƒã‚±ãƒƒãƒˆã¨ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
aws s3 ls | grep dl-handson
aws s3 ls s3://dl-handson-raw-dev/ecommerce/ --recursive

# 3. Glueã‚«ã‚¿ãƒ­ã‚°ã‚’ç¢ºèª  
aws glue get-databases --region us-east-1
aws glue get-tables --database-name dl_handson_db --region us-east-1

# 4. EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹ã‚’ç¢ºèª
aws emr list-clusters --region us-east-1

# 5. ç°¡å˜ãªAthenaã‚¯ã‚¨ãƒªã‚’ãƒ†ã‚¹ãƒˆ
aws athena start-query-execution \
  --query-string "SELECT COUNT(*) FROM dl_handson_db.customers;" \
  --work-group primary \
  --result-configuration OutputLocation=s3://dl-handson-athena-results-dev/
```

#### ğŸ§ª ãƒ‡ãƒ¼ã‚¿å“è³ªæ¤œè¨¼
```bash
# ãƒ‡ãƒ¼ã‚¿ã‚«ã‚¦ãƒ³ãƒˆã®ç¢ºèª
echo "=== ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ ==="
aws athena start-query-execution \
  --query-string "SELECT 'customers' as table_name, COUNT(*) as row_count FROM dl_handson_db.customers
                  UNION ALL  
                  SELECT 'orders' as table_name, COUNT(*) as row_count FROM dl_handson_db.orders
                  UNION ALL
                  SELECT 'products' as table_name, COUNT(*) as row_count FROM dl_handson_db.products;" \
  --work-group primary \
  --result-configuration OutputLocation=s3://dl-handson-athena-results-dev/
```

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã¨æœ€é©åŒ–

#### ğŸ§¹ æ®µéšçš„ãƒªã‚½ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```bash
# 1. EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’çµ‚äº†ï¼ˆæœ€é«˜å„ªå…ˆåº¦ - ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
aws emr terminate-clusters --cluster-ids j-XXXXXXXXX

# 2. ä¸€æ™‚çš„ãªGlueã‚¸ãƒ§ãƒ–ã¨Crawlerã‚’åœæ­¢
aws glue stop-crawler --name dl-handson-raw-crawler
aws databrew delete-job --name cleaning-job

# 3. S3ãƒ‡ãƒ¼ã‚¿ã‚’é¸æŠçš„ã«å‰Šé™¤ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
aws s3 rm s3://dl-handson-raw-dev/temp/ --recursive
aws s3 rm s3://dl-handson-analytics-dev/temp/ --recursive

# 4. å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆå…¨ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼‰
./scripts/cleanup.sh
```

#### ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ç¢ºèª
```bash
# ç¾åœ¨ã®ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
./scripts/cost-optimization.sh

# ä¸»è¦ãªã‚³ã‚¹ãƒˆè¦å› ã‚’ãƒã‚§ãƒƒã‚¯
aws emr list-clusters --active --region us-east-1  # EMRç¢ºèª
aws s3api list-buckets --query "Buckets[?contains(Name, 'dl-handson')]"  # S3ç¢ºèª

# AWS Cost Explorerã§ã‚³ã‚¹ãƒˆã‚’ç›£è¦–
echo "AWS Cost Explorerã§Daily cost trendã‚’ç¢ºèªã—ã¦ãã ã•ã„"
echo "URL: https://console.aws.amazon.com/cost-management/home?region=us-east-1#/dashboard"
```

#### ğŸ“‹ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] å…¨ã¦ã®CloudFormationã‚¹ã‚¿ãƒƒã‚¯ãŒ `CREATE_COMPLETE` çŠ¶æ…‹
- [ ] S3ãƒã‚±ãƒƒãƒˆï¼ˆ4å€‹ï¼‰ãŒä½œæˆã•ã‚Œã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿  
- [ ] IAMãƒ­ãƒ¼ãƒ«ï¼ˆ7å€‹ï¼‰ãŒæ­£ã—ãä½œæˆã•ã‚Œã€æ¨©é™ãŒè¨­å®šæ¸ˆã¿
- [ ] Glueãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã€ã‚¹ã‚­ãƒ¼ãƒãŒç™ºè¦‹æ¸ˆã¿
- [ ] EMRã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒä½œæˆã•ã‚Œã€PySparkã‚¸ãƒ§ãƒ–ãŒå®Ÿè¡Œæ¸ˆã¿ï¼ˆã¾ãŸã¯çµ‚äº†æ¸ˆã¿ï¼‰
- [ ] Athenaã§ã‚¯ã‚¨ãƒªãŒå®Ÿè¡Œå¯èƒ½ã§ã€çµæœãŒå–å¾—ã§ãã‚‹
- [ ] ã‚³ã‚¹ãƒˆç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¨­å®šã•ã‚Œã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ãŒç¢ºèªæ¸ˆã¿
- [ ] ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•ä½œãŒç¢ºèªæ¸ˆã¿

> **ğŸ’¡ Pro Tip**: å„ã‚¹ãƒ†ãƒƒãƒ—å®Œäº†å¾Œã¯å¿…ãšãƒªã‚½ãƒ¼ã‚¹çŠ¶æ…‹ã‚’ç¢ºèªã—ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚€å‰ã«å•é¡ŒãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€CloudFormationã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚„CloudWatchãƒ­ã‚°ã§è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚

## æ‹¡å¼µå­¦ç¿’

### ä¸Šç´šãƒˆãƒ”ãƒƒã‚¯
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆLambda + Kinesisï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ï¼ˆKinesis Analyticsï¼‰
- æ©Ÿæ¢°å­¦ç¿’çµ±åˆï¼ˆSageMakerï¼‰
- ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ï¼ˆQuickSightï¼‰

### ä¼æ¥­ãƒ¬ãƒ™ãƒ«æ‹¡å¼µ
- ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ãƒ‡ãƒ¼ã‚¿ç³»è­œã¨ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆåˆ†æ
- è‡ªå‹•åŒ–ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯
- ç½å®³å¾©æ—§ã¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ•™è‚²ãƒ»å­¦ç¿’ç›®çš„ã®ã¿ã«ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚æœ¬ç•ªç’°å¢ƒã§ã®ç›´æ¥ä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚å®Ÿéš›ã®ä½¿ç”¨å‰ã«ååˆ†ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

---

> **é‡è¦ãªæ³¨æ„**: å®Ÿé¨“å®Œäº†å¾Œã¯å¿…ãšã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã€ä¸è¦ãªAWSæ–™é‡‘ã®ç™ºç”Ÿã‚’é¿ã‘ã¦ãã ã•ã„ã€‚